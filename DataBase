DROP DATABASE IF EXISTS db_mis_pronaltex;
CREATE DATABASE db_mis_pronaltex
CHARACTER SET utf8mb4
COLLATE utf8mb4_0900_ai_ci;

USE db_mis_pronaltex;

/* TABLA: USUARIO */
CREATE TABLE usuario (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100),
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);

/* TABLA: CLIENTE */
CREATE TABLE cliente (
    id_cliente INT AUTO_INCREMENT PRIMARY KEY,
    tipo_cliente ENUM('empresa','persona') NOT NULL,
    nombre_razon_social VARCHAR(150),
    numero_identificacion VARCHAR(20) NOT NULL UNIQUE,
    direccion VARCHAR(200),
    telefono VARCHAR(20),
    email VARCHAR(100),
    password VARCHAR(255) NOT NULL
);

/* TABLA: PRODUCTO */
CREATE TABLE producto (
    id_producto INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    tipo_producto VARCHAR(50),
    descripcion TEXT,
    precio_unitario DECIMAL(12,2) NOT NULL CHECK (precio_unitario > 0),
    stock_actual INT DEFAULT 0,
    categoria VARCHAR(100) NOT NULL
);

/* TABLA: CARRITO DE COMPRAS */
CREATE TABLE carrito (
    id_carrito INT AUTO_INCREMENT PRIMARY KEY,
    id_cliente INT NOT NULL,
    fecha_creacion DATETIME DEFAULT CURRENT_TIMESTAMP,
    estado ENUM('activo','finalizado') DEFAULT 'activo',
    FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente)
);

/* TABLA: DETALLE CARRITO */
CREATE TABLE carrito_detalle (
    id_detalle INT AUTO_INCREMENT PRIMARY KEY,
    id_carrito INT NOT NULL,
    id_producto INT NOT NULL,
    cantidad INT NOT NULL CHECK (cantidad > 0),
    subtotal DECIMAL(12,2),
    FOREIGN KEY (id_carrito) REFERENCES carrito(id_carrito),
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto)
);

/* TABLA: VENTA */
CREATE TABLE venta (
    id_venta INT AUTO_INCREMENT PRIMARY KEY,
    id_cliente INT NOT NULL,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP,
    total DECIMAL(12,2),
    metodo_pago ENUM('efectivo','transferencia','tarjeta'),
    FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente)
);

/* =========================================================
   DATOS DE EJEMPLO
   ========================================================= */

/* USUARIOS */
INSERT INTO usuario (username,email,password) VALUES
('Administrador','admin@pronaltex.com','$2b$10$adminhash'),
('Vendedor','ventas@pronaltex.com','$2b$10$ventashash');

/* CLIENTES */
INSERT INTO cliente
(tipo_cliente,nombre_razon_social,numero_identificacion,direccion,telefono,email,password)
VALUES
('persona','Juan Pérez','1010101010','Calle 10 #10-10','3001234567','juan@gmail.com','hash'),
('empresa','Seguridad Total S.A.S','900123456','Zona Industrial','6011234567','contacto@seguridad.com','hash');

/* PRODUCTOS */
INSERT INTO producto
(nombre,tipo_producto,descripcion,precio_unitario,stock_actual,categoria)
VALUES
('Extintor ABC 10 lbs','Extintores','Uso multipropósito',45000,30,'Equipos contra incendios'),
('Camilla plástica','Camillas','Alta resistencia',135000,15,'Equipos de emergencia'),
('Gabinete contra incendio','Gabinete','Gabinete metálico',80000,20,'Equipos contra incendios');

/* CARRITO */
INSERT INTO carrito (id_cliente,estado) VALUES
(1,'activo');

/* DETALLE CARRITO */
INSERT INTO carrito_detalle
(id_carrito,id_producto,cantidad,subtotal)
VALUES
(1,1,2,90000),
(1,2,1,135000);

/* VENTA */
INSERT INTO venta
(id_cliente,fecha,total,metodo_pago)
VALUES
(1,'2025-01-15 10:30:00',225000,'tarjeta');